"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("react/jsx-runtime"),u=require("react"),R=require("../ui/label.cjs.js"),l=require("../ui/sheet.cjs.js"),j=require("../ui/button.cjs.js"),F=require("../ui/input.cjs.js"),M=require("../Checkbox/Checkbox.cjs.js"),T=require("../Select/Select.cjs.js"),B=require("lucide-react");function L({sheetTrigger:C="Open",sheetTitle:E="",sheetDescription:k="",sheetFooterButton:N="Save changes",buttonAction:O=()=>{},sheetFields:c,loading:o=!1,additionalContent:w=null,error:x=!1,onFieldChange:g,...V}){const[i,p]=u.useState(!1),[v,b]=u.useState({}),y=u.useRef(o),m=u.useMemo(()=>()=>{const e={};return c.forEach(t=>{t.inputDefault!==void 0&&(e[t.id]=t.inputDefault)}),e},[c]),[a,f]=u.useState(m),D=e=>{const t={};return c.forEach(s=>{if(s.validate){const n=s.validate(e[s.id]);n&&(t[s.id]=n)}}),t},S=u.useMemo(()=>c.some(t=>{if(t.required)switch(t.type??"text"){case"checkbox":return a[t.id]!==!0;case"select":case"textarea":case"text":case"email":case"number":case"password":case"tel":return!a[t.id];default:return!1}return!1})||o,[c,a,o]),h=(e,t)=>{const s={...a,[e]:t};f(s),c.find(d=>d.id===e)?.triggerFieldUpdate&&g&&g(e,t,s)},I=async e=>{if(S)return;const t=D(a);if(b(t),!(Object.keys(t).length>0))try{await O(e,a)!==!1&&!o&&!x&&setTimeout(()=>p(!1))}catch(s){console.error("Error in button action:",s)}};return u.useEffect(()=>{i&&(f(m()),b({}))},[i,m]),u.useEffect(()=>{y.current===!0&&o===!1&&i&&!x&&p(!1),y.current=o},[o,i,x]),u.useEffect(()=>{const e=c.map(n=>n.id),t=Object.keys(a),s={...a};t.forEach(n=>{e.includes(n)||delete s[n]}),c.forEach(n=>{n.inputDefault!==void 0&&!(n.id in s)&&(s[n.id]=n.inputDefault)}),f(s),b(n=>{const d={...n};return Object.keys(d).forEach(q=>{e.includes(q)||delete d[q]}),d})},[c]),r.jsxs(l.Sheet,{open:i,onOpenChange:p,...V,children:[r.jsx(l.SheetTrigger,{asChild:!0,children:r.jsx(j.Button,{children:C})}),r.jsxs(l.SheetContent,{className:"flex flex-col h-full",children:[r.jsxs(l.SheetHeader,{children:[r.jsx(l.SheetTitle,{children:E}),r.jsx(l.SheetDescription,{children:k})]}),r.jsxs("div",{className:"flex flex-col gap-4 overflow-y-auto",children:[c.map(e=>r.jsx("div",{className:"grid auto-rows-min gap-6 px-4",children:r.jsxs("div",{className:"grid gap-3",children:[e.type!=="checkbox"&&r.jsxs(R.Label,{htmlFor:e.id,children:[e.label,e.required&&r.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),(()=>{switch(e.type){case"checkbox":return r.jsx("div",{className:"flex items-center space-x-2",children:r.jsx(M.default,{label:e.label,id:e.id,checked:a[e.id]===!0||a[e.id]==="true",onCheckedChange:t=>h(e.id,t)})});case"textarea":return r.jsx("textarea",{id:e.id,className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:a[e.id]||"",onChange:t=>h(e.id,t.target.value),placeholder:e?.placeholder,readOnly:e.readOnly});case"select":return r.jsx(T.default,{placeholder:e?.placeholder||"",options:e?.options||[],value:a[e.id]||"",onValueChange:t=>h(e.id,t)});default:return r.jsx(F.Input,{type:e?.type||"text",id:e.id,value:a[e.id]||"",onChange:t=>h(e.id,t.target.value),placeholder:e?.placeholder,readOnly:e.readOnly})}})(),v[e.id]&&r.jsx("p",{className:"text-sm text-red-500",children:v[e.id]})]})},e.id)),r.jsx("section",{className:"px-4",children:w})]}),r.jsxs(l.SheetFooter,{children:[r.jsxs(j.Button,{onClick:I,disabled:S,children:[o&&r.jsx(B.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),N]}),r.jsx(l.SheetClose,{asChild:!0,children:r.jsx(j.Button,{variant:"outline",children:"Close"})})]})]})]})}exports.default=L;
