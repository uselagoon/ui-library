"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("react/jsx-runtime"),l=require("react"),g=require("./index.cjs13.js"),P=require("./index.cjs33.js"),Q=require("./index.cjs14.js"),w=require("./index.cjs99.js"),X=require("./index.cjs29.js"),h=require("./index.cjs38.js"),Z=require("./index.cjs45.js"),B=require("./index.cjs70.js"),T=require("lucide-react"),y=(c,i="en-us")=>c.toLocaleDateString(i,{month:"short",day:"numeric",year:"numeric"}),Y=c=>{if(typeof c=="string"){const i=c.split("-").map(x=>Number.parseInt(x,10));return new Date(i[0],i[1]-1,i[2])}else return c},b=[{name:"today",label:"Today"},{name:"yesterday",label:"Yesterday"},{name:"last7",label:"Last 7 days"},{name:"last14",label:"Last 14 days"},{name:"last30",label:"Last 30 days"},{name:"thisWeek",label:"This Week"},{name:"lastWeek",label:"Last Week"},{name:"thisMonth",label:"This Month"},{name:"lastMonth",label:"Last Month"}],O=({initialDateFrom:c,initialDateTo:i,initialCompareFrom:R,initialCompareTo:x,onUpdate:q,align:$="end",locale:p="en-US",showCompare:U=!0,rangeText:V=void 0,...A})=>{const F=c!==void 0,[I,D]=l.useState(!1),[a,d]=l.useState(()=>{if(F){const e=Y(c),n=i?Y(i):e;return{from:e,to:n}}else{const e=new Date(new Date().setHours(0,0,0,0));return{from:e,to:e}}}),[r,u]=l.useState(()=>{if(R){const e=new Date(new Date(R).setHours(0,0,0,0)),n=x?new Date(new Date(x).setHours(0,0,0,0)):e;return{from:e,to:n}}}),[S,m]=l.useState(F),k=l.useRef(),C=l.useRef(),H=l.useRef(!1),f=l.useRef(!1),[z,N]=l.useState(void 0),[v,_]=l.useState(typeof window<"u"?window.innerWidth<960:!1);l.useEffect(()=>{const e=()=>{_(window.innerWidth<960)};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]);const L=e=>{const n=b.find(({name:M})=>M===e);if(!n)throw new Error(`Unknown date range preset: ${e}`);const s=new Date,o=new Date,j=s.getDate()-s.getDay();switch(n.name){case"today":s.setHours(0,0,0,0),o.setHours(23,59,59,999);break;case"yesterday":s.setDate(s.getDate()-1),s.setHours(0,0,0,0),o.setDate(o.getDate()-1),o.setHours(23,59,59,999);break;case"last7":s.setDate(s.getDate()-6),s.setHours(0,0,0,0),o.setHours(23,59,59,999);break;case"last14":s.setDate(s.getDate()-13),s.setHours(0,0,0,0),o.setHours(23,59,59,999);break;case"last30":s.setDate(s.getDate()-29),s.setHours(0,0,0,0),o.setHours(23,59,59,999);break;case"thisWeek":s.setDate(j),s.setHours(0,0,0,0),o.setHours(23,59,59,999);break;case"lastWeek":s.setDate(s.getDate()-7-s.getDay()),o.setDate(o.getDate()-o.getDay()-1),s.setHours(0,0,0,0),o.setHours(23,59,59,999);break;case"thisMonth":s.setDate(1),s.setHours(0,0,0,0),o.setHours(23,59,59,999);break;case"lastMonth":s.setMonth(s.getMonth()-1),s.setDate(1),s.setHours(0,0,0,0),o.setDate(0),o.setHours(23,59,59,999);break}return{from:s,to:o}},E=e=>{const n=L(e);if(d(n),m(!0),r){const s={from:new Date(n.from.getFullYear()-1,n.from.getMonth(),n.from.getDate()),to:n.to?new Date(n.to.getFullYear()-1,n.to.getMonth(),n.to.getDate()):void 0};u(s)}},G=()=>{for(const e of b){const n=L(e.name),s=new Date(a.from);s.setHours(0,0,0,0);const o=new Date(n.from.setHours(0,0,0,0)),j=new Date(a.to??0);j.setHours(0,0,0,0);const M=new Date(n.to?.setHours(0,0,0,0)??0);if(s.getTime()===o.getTime()&&j.getTime()===M.getTime()){N(e.name);return}}N(void 0)};l.useEffect(()=>{G()},[a]);const J=({preset:e,label:n,isSelected:s})=>t.jsx(g.Button,{className:B.cn(s&&"pointer-events-none"),variant:"ghost",onClick:()=>{E(e)},children:t.jsxs(t.Fragment,{children:[t.jsx("span",{className:B.cn("pr-2 opacity-0",s&&"opacity-70"),children:t.jsx(T.Check,{width:18,height:18})}),n]})}),W=(e,n)=>!e||!n?e===n:e.from.getTime()===n.from.getTime()&&(!e.to||!n.to||e.to.getTime()===n.to.getTime()),K=()=>{d({from:void 0,to:void 0}),u(void 0),m(!1),N(void 0),f.current=!0,D(!1),q?.({range:{from:void 0,to:void 0},rangeCompare:void 0})};return t.jsxs(P.Popover,{modal:!0,open:I,onOpenChange:e=>{e?(k.current=a,C.current=r,H.current=S,f.current=!1):(f.current||(d(k.current||a),u(C.current),m(H.current)),f.current=!1),D(e)},...A,children:[t.jsx(P.PopoverTrigger,{children:t.jsxs(g.Button,{size:"lg",variant:"outline",children:[t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"py-1",children:S?t.jsx("div",{children:`${y(a.from,p)}${a.to!=null?" - "+y(a.to,p):""}`}):t.jsx("div",{children:V??"Select a date range"})}),r!=null&&t.jsx("div",{className:"opacity-60 text-xs -mt-1",children:t.jsxs(t.Fragment,{children:["vs. ",y(r.from,p),r.to!=null?` - ${y(r.to,p)}`:""]})})]}),t.jsx("div",{className:"pl-1 opacity-60 -mr-2 scale-125",children:I?t.jsx(T.ChevronUp,{width:24}):t.jsx(T.ChevronDown,{width:24})})]})}),t.jsxs(P.PopoverContent,{align:$,className:"w-auto",children:[t.jsxs("div",{className:"flex py-2",children:[t.jsx("div",{className:"flex",children:t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("div",{className:"flex flex-col lg:flex-row gap-2 px-3 justify-end items-center lg:items-start pb-4 lg:pb-0",children:[U&&t.jsxs("div",{className:"flex items-center space-x-2 pr-4 py-1",children:[t.jsx(Z.Switch,{defaultChecked:!!r,onCheckedChange:e=>{e?(a.to||d(n=>({...n,to:n.from})),u({from:new Date(a.from.getFullYear(),a.from.getMonth(),a.from.getDate()-365),to:a.to?new Date(a.to.getFullYear()-1,a.to.getMonth(),a.to.getDate()):new Date(a.from.getFullYear()-1,a.from.getMonth(),a.from.getDate())})):u(void 0)},id:"compare-mode"}),t.jsx(X.Label,{htmlFor:"compare-mode",children:"Compare"})]}),t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsxs("div",{className:"flex gap-2",children:[t.jsx(w.DateInput,{value:a.from,onChange:e=>{const n=a.to==null||e>a.to?e:a.to;d(s=>({...s,from:e,to:n})),m(!0)}}),t.jsx("div",{className:"py-1",children:"-"}),t.jsx(w.DateInput,{value:a.to,onChange:e=>{const n=e<a.from?e:a.from;d(s=>({...s,from:n,to:e})),m(!0)}})]}),r!=null&&t.jsxs("div",{className:"flex gap-2",children:[t.jsx(w.DateInput,{value:r?.from,onChange:e=>{if(r){const n=r.to==null||e>r.to?e:r.to;u(s=>({...s,from:e,to:n}))}else u({from:e,to:new Date})}}),t.jsx("div",{className:"py-1",children:"-"}),t.jsx(w.DateInput,{value:r?.to,onChange:e=>{if(r&&r.from){const n=e<r.from?e:r.from;u({...r,from:n,to:e})}}})]})]})]}),v&&t.jsxs(h.Select,{defaultValue:z,onValueChange:e=>{E(e)},children:[t.jsx(h.SelectTrigger,{className:"w-[180px] mx-auto mb-2",children:t.jsx(h.SelectValue,{placeholder:"Select..."})}),t.jsx(h.SelectContent,{children:b.map(e=>t.jsx(h.SelectItem,{value:e.name,children:e.label},e.name))})]}),t.jsx("div",{children:t.jsx(Q.Calendar,{mode:"range",onSelect:e=>{e?.from!=null?(d({from:e.from,to:e?.to}),m(!0)):m(!1)},selected:a,numberOfMonths:v?1:2,defaultMonth:new Date(new Date().setMonth(new Date().getMonth()-(v?0:1)))})})]})}),!v&&t.jsx("div",{className:"flex flex-col items-end gap-1 pr-2 pl-6 pb-6",children:t.jsx("div",{className:"flex w-full flex-col items-end gap-1 pr-2 pl-6 pb-6",children:b.map(e=>t.jsx(J,{preset:e.name,label:e.label,isSelected:z===e.name},e.name))})})]}),t.jsxs("div",{className:"flex justify-end gap-2 py-2 pr-4",children:[t.jsx(g.Button,{onClick:K,variant:"ghost",children:"Clear"}),t.jsx(g.Button,{onClick:()=>{D(!1)},variant:"ghost",children:"Cancel"}),t.jsx(g.Button,{onClick:()=>{(!W(a,k.current)||!W(r,C.current)||S!==H.current)&&q?.({range:a,rangeCompare:r}),f.current=!0,D(!1)},children:"Update"})]})]})]})};O.displayName="DateRangePicker";exports.DateRangePicker=O;
